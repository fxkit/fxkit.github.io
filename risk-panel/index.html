<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Risk Management Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º SDK cTrader -->
  <script src="https://plugins.ctrader.com/sdk/ctrader-sdk-v1.js"></script>
  <script>
    let accountBalance = 0;
    let accountCurrency = "USD";

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    async function initAccount() {
      try {
        const account = await cTrader.getAccount();
        accountBalance = account.balance;
        accountCurrency = account.currency;

        document.getElementById("balance").value = accountBalance.toFixed(2);
        document.getElementById("currencyLabel").innerText = accountCurrency;
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞:", e);
      }
    }

    async function calculate() {
      let balance = parseFloat(document.getElementById("balance").value);
      let riskPercent = parseFloat(document.getElementById("risk").value);
      let slPips = parseFloat(document.getElementById("sl").value);
      let rr = parseFloat(document.getElementById("rr").value);
      let pair = document.getElementById("pair").value;

      if (!balance || !riskPercent || !slPips || !pair || !rr) {
        document.getElementById("result").innerHTML =
                `<p class="text-red-500">‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è</p>`;
        return;
      }

      let risk = riskPercent / 100;
      let riskAmount = balance * risk;

      // –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—É–Ω–∫—Ç–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)
      let pipValue = 10;
      if (pair.includes("JPY")) pipValue = 9;
      if (pair.includes("XAU")) pipValue = 1;

      // –†–∞—Å—á—ë—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
      let lotSize = riskAmount / (slPips * pipValue);

      // –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å –ø–æ R:R
      let potentialProfit = riskAmount * rr;

      document.getElementById("result").innerHTML = `
        <div class="p-4 mt-4 bg-green-100 rounded-xl">
          <p><b>–ë–∞–ª–∞–Ω—Å:</b> ${balance.toFixed(2)} ${accountCurrency}</p>
          <p><b>–†–∏—Å–∫:</b> ${riskAmount.toFixed(2)} ${accountCurrency}</p>
          <p><b>–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏:</b> ${lotSize.toFixed(2)} –ª–æ—Ç–∞</p>
          <p><b>R:R:</b> 1:${rr}</p>
          <p><b>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å:</b> ${potentialProfit.toFixed(2)} ${accountCurrency}</p>
        </div>
      `;
    }

    window.onload = initAccount;
  </script>
</head>
<body class="bg-gray-100 p-6 font-sans">
<div class="max-w-md mx-auto bg-white rounded-2xl shadow-lg p-6">
  <h2 class="text-xl font-bold mb-4 text-center">üìä Risk Management Panel</h2>

  <label class="block mb-2 font-medium">–ë–∞–ª–∞–Ω—Å (<span id="currencyLabel">USD</span>):</label>
  <input id="balance" type="number" class="w-full mb-4 p-2 border rounded-lg" readonly />

  <label class="block mb-2 font-medium">–†–∏—Å–∫ (%):</label>
  <input id="risk" type="number" class="w-full mb-4 p-2 border rounded-lg" />

  <label class="block mb-2 font-medium">–°—Ç–æ–ø-–ª–æ—Å—Å (–ø—É–Ω–∫—Ç—ã):</label>
  <input id="sl" type="number" class="w-full mb-4 p-2 border rounded-lg" />

  <label class="block mb-2 font-medium">–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞:</label>
  <select id="pair" class="w-full mb-4 p-2 border rounded-lg">
    <option value="EURUSD">EURUSD</option>
    <option value="GBPUSD">GBPUSD</option>
    <option value="USDJPY">USDJPY</option>
    <option value="XAUUSD">XAUUSD (Gold)</option>
  </select>

  <label class="block mb-2 font-medium">R:R (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2 = 1:2):</label>
  <input id="rr" type="number" class="w-full mb-4 p-2 border rounded-lg" value="2" />

  <button onclick="calculate()" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 transition">
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
  </button>

  <div id="result" class="text-lg mt-4"></div>
</div>
</body>
</html>
